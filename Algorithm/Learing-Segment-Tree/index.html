<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>线段树学习 | 2inf</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><!-- modified--><link rel="stylesheet" type="text/css" href="/css/atom-one-dark.min.css?v=0.0.0"><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script><!----><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">线段树学习</h1><a id="logo" href="/.">2inf</a><p class="description">wtyangのスペース</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/" target="_self"><i class="fa fa-archive"> 归档</i></a><a href="/tags/" target="_self"><i class="fa fa-tags"> 标签</i></a><a href="/about/" target="_self"><i class="fa fa-user"> 关于</i></a><a href="https://note.2inf.top" target="_self"><i class="fa fa-book"> 笔记</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">线段树学习</h1><div class="post-meta">2020-04-22<span> | </span><span class="category"><a href="/categories/Algorithm/">Algorithm</a></span></div><div class="post-content"><h1 id="基础">基础</h1>
<h2 id="概念">概念</h2>
<p>  线段树(<a href="https://en.wikipedia.org/wiki/Segment_tree" target="_blank" rel="noopener">Segment tree</a>)是基于分治的二叉树，用于在区间上进行信息统计。线段树每个节点都代表一个区间，每个叶节点代表长度为1的区间，每个内部节点<span class="math inline">\([l,r]\)</span>，左子节点<span class="math inline">\([l,mid]\)</span>，右子节点<span class="math inline">\([mid+1,r]\)</span>，其中<span class="math inline">\(mid=\lfloor\frac{l+r}{2}\rfloor\)</span>。</p>
<p>  除去树的最后一层，整棵线段树一定是一颗完全二叉树，树的深度为<span class="math inline">\(O(\log{N})\)</span>。我们将根节点编号为<span class="math inline">\(1\)</span>，编号为<span class="math inline">\(x\)</span>的节点左子节点为<span class="math inline">\(x*2\)</span>，右子节点编号为<span class="math inline">\(x*2+1\)</span>。<span class="math inline">\(N\)</span>个叶节点的满二叉树有<span class="math inline">\(1+2+\cdots+\frac{N}{2}+N=2N-1\)</span>个节点，而最后一层有空余，故保存线段树数组长度不小于<span class="math inline">\(4N\)</span>。</p>
<p>  以区间最大值为例</p>
<ul>
<li>建树</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span> &#123;</span></span><br><span class="line">    <span class="hljs-keyword">int</span> l, r;</span><br><span class="line">    <span class="hljs-keyword">int</span> dat;</span><br><span class="line">&#125;t[N&lt;&lt;<span class="hljs-number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    t[p].l = l, t[p].r = r;</span><br><span class="line">    <span class="hljs-keyword">if</span> (l == r) &#123; t[p].dat = a[l]; <span class="hljs-keyword">return</span>; &#125;</span><br><span class="line">    <span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">    build(p&lt;&lt;<span class="hljs-number">1</span>, l, mid);</span><br><span class="line">    build(p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r);</span><br><span class="line">    t[p].dat = max(t[p&lt;&lt;<span class="hljs-number">1</span>].dat, t[p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>].dat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>单点修改</li>
</ul>
<p>  从根节点出发，递归找到区间<span class="math inline">\([x,x]\)</span>的节点，从下往上更新<span class="math inline">\([x,x]\)</span>及所有父节点的信息，复杂度<span class="math inline">\(O(\log{N})\)</span>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (t[p].l == t[p].r) &#123; t[p].dat = v; <span class="hljs-keyword">return</span>; &#125;</span><br><span class="line">    <span class="hljs-keyword">int</span> mid = (t[p].l + t[p].r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span> (x &lt;= mid) update(p&lt;&lt;<span class="hljs-number">1</span>, x, v);</span><br><span class="line">    <span class="hljs-keyword">else</span> update(p&lt;&lt;<span class="hljs-number">1</span> | <span class="hljs-number">1</span>, x, v);</span><br><span class="line">    t[p].dat = max(t[p&lt;&lt;<span class="hljs-number">1</span>].dat, t[p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>].dat);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>区间查询</li>
</ul>
<ol type="1">
<li>若<span class="math inline">\([l,r]\)</span>完全覆盖当前节点区间，立即回溯，该节点<span class="math inline">\(dat\)</span>为候选答案。</li>
<li>若左子节点与<span class="math inline">\([l,r]\)</span>有重叠，递归访问左子节点。</li>
<li>若右子节点与<span class="math inline">\([l,r]\)</span>有重叠，递归访问右子节点。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (l &lt;= t[p].l &amp;&amp; r &gt;= t[p].r) <span class="hljs-keyword">return</span> t[p].dat;</span><br><span class="line">    <span class="hljs-keyword">int</span> mid = (t[p].l + t[p].r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">int</span> ans = -INF;</span><br><span class="line">    <span class="hljs-keyword">if</span> (l &lt;= mid) ans = max(ans, query(p&lt;&lt;<span class="hljs-number">1</span>, l, r));</span><br><span class="line">    <span class="hljs-keyword">if</span> (r &gt; mid) ans = max(ans, query(p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, l, r));</span><br><span class="line">    <span class="hljs-keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>延迟标记(lazy-tag)</li>
</ul>
<p>  一般用于处理线段树的区间更新，如果某个节点被修改区间<span class="math inline">\([l,r]\)</span>完全覆盖，以该节点为根的子树所有节点信息会发生变化，若逐一更新，一次区间修改时间复杂度为<span class="math inline">\(O(N)\)</span>，为了提高效率，每次更新只更新到更新区间完全覆盖线段树节点区间为止，在被更新节点打上标记，下次访问节点再将标记传给子节点。</p>
<p>  什么时候用？统计量可合并、修改量可合并、通过修改量可直接修改统计量，即满⾜区间加法即可使用线段树维护信息。</p>
<hr>
<p><a href="https://www.luogu.com.cn/problem/P3372" target="_blank" rel="noopener">P3372 线段树1</a></p>
<p><a href="https://paste.ubuntu.com/p/dp6XmZdkqs/" target="_blank" rel="noopener">参考代码</a></p>
<hr>
<p><a href="https://www.luogu.com.cn/problem/P3373" target="_blank" rel="noopener">P3373 线段树2</a></p>
<p>  本题有两种修改、一种查询取模后的结果共三种操作，向下传递lazy-tag时需考虑先后顺序，如果先加后乘则会有小数运算损失精度，所以先乘后加。</p>
<p><a href="https://paste.ubuntu.com/p/nYWWrvcqws/" target="_blank" rel="noopener">参考代码</a></p>
<h2 id="经典应用">经典应用</h2>
<h3 id="区间最值">区间最值</h3>
<p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=1067" target="_blank" rel="noopener">bzoj1067 [SCOI2007]降雨量</a></p>
<blockquote>
<p>题意：给出<span class="math inline">\(n(1\le n\le50000)\)</span>条信息，第<span class="math inline">\(y_i(-10^9\le y_i\le10^9)\)</span>年降雨量为<span class="math inline">\(r_i(-10^9\le r_i\le10^9)\)</span>，给出<span class="math inline">\(m(1\le m\le10000)\)</span>条询问，格式<span class="math inline">\(Y\)</span>和<span class="math inline">\(X\)</span>，<span class="math inline">\(X\)</span>年是自<span class="math inline">\(Y\)</span>年以来降雨量最多的。这句话是真、假或有可能。</p>
</blockquote>
<p>  难点主要在分类讨论。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> debug(x) cout &lt;&lt; #x &lt;&lt; <span class="hljs-meta-string">" is "</span> &lt;&lt; x &lt;&lt; endl</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> inc(i, a, b) for (int i = a; i &lt;= b; ++i)</span></span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">5e4</span> + <span class="hljs-number">5</span>, INF = <span class="hljs-number">2e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span> &#123;</span></span><br><span class="line">	<span class="hljs-keyword">int</span> l, r;</span><br><span class="line">	<span class="hljs-keyword">int</span> dat;</span><br><span class="line">&#125;t[N&lt;&lt;<span class="hljs-number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">int</span> y[N], a[N], n, m;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	t[p].l = l, t[p].r = r;</span><br><span class="line">	<span class="hljs-keyword">if</span> (l == r) &#123; t[p].dat = a[l]; <span class="hljs-keyword">return</span>; &#125;</span><br><span class="line">	<span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">	build(p&lt;&lt;<span class="hljs-number">1</span>, l, mid);</span><br><span class="line">	build(p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r);</span><br><span class="line">	t[p].dat = max(t[p&lt;&lt;<span class="hljs-number">1</span>].dat, t[p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>].dat);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (l &gt; r) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;</span><br><span class="line">    <span class="hljs-keyword">if</span> (l &lt;= t[p].l &amp;&amp; r &gt;= t[p].r) <span class="hljs-keyword">return</span> t[p].dat;</span><br><span class="line">    <span class="hljs-keyword">int</span> mid = (t[p].l + t[p].r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">int</span> ans = -INF;</span><br><span class="line">    <span class="hljs-keyword">if</span> (l &lt;= mid) ans = max(ans, query(p&lt;&lt;<span class="hljs-number">1</span>, l, r));</span><br><span class="line">    <span class="hljs-keyword">if</span> (r &gt; mid) ans = max(ans, query(p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, l, r));</span><br><span class="line">    <span class="hljs-keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;y[i], &amp;a[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	build(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n);</span><br><span class="line">	<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;m);</span><br><span class="line">	<span class="hljs-keyword">while</span> (m--) &#123;</span><br><span class="line">		<span class="hljs-keyword">int</span> p, q;</span><br><span class="line">		<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d%d"</span>, &amp;p, &amp;q);</span><br><span class="line">		<span class="hljs-keyword">if</span> (q &lt; p) &#123; <span class="hljs-built_in">puts</span>(<span class="hljs-string">"false"</span>); <span class="hljs-keyword">continue</span>; &#125;</span><br><span class="line">		<span class="hljs-keyword">int</span> l = lower_bound(y + <span class="hljs-number">1</span>, y + n + <span class="hljs-number">1</span>, p) - y;</span><br><span class="line">		<span class="hljs-keyword">int</span> r = lower_bound(y + <span class="hljs-number">1</span>, y + n + <span class="hljs-number">1</span>, q) - y;</span><br><span class="line">		<span class="hljs-keyword">if</span> (y[l] == p &amp;&amp; y[r] == q) &#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> (a[l] &lt; a[r] || query(<span class="hljs-number">1</span>, l + <span class="hljs-number">1</span>, r - <span class="hljs-number">1</span>) &gt;= a[r]) <span class="hljs-built_in">puts</span>(<span class="hljs-string">"false"</span>);</span><br><span class="line">			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (q - p == r - l) <span class="hljs-built_in">puts</span>(<span class="hljs-string">"true"</span>);</span><br><span class="line">			<span class="hljs-keyword">else</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"maybe"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y[l] != p &amp;&amp; y[r] != q) <span class="hljs-built_in">puts</span>(<span class="hljs-string">"maybe"</span>);</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y[r] != q) &#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> (query(<span class="hljs-number">1</span>, l + <span class="hljs-number">1</span>, r - <span class="hljs-number">1</span>) &gt;= a[l]) <span class="hljs-built_in">puts</span>(<span class="hljs-string">"false"</span>);</span><br><span class="line">			<span class="hljs-keyword">else</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"maybe"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> &#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> (query(<span class="hljs-number">1</span>, l, r - <span class="hljs-number">1</span>) &gt;= a[r]) <span class="hljs-built_in">puts</span>(<span class="hljs-string">"false"</span>);</span><br><span class="line">			<span class="hljs-keyword">else</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"maybe"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="区间求和">区间求和</h3>
<p><a href="http://acm.hdu.edu.cn/showproblem.php?pid=4288" target="_blank" rel="noopener">hdu4288 Coder</a></p>
<blockquote>
<p>题意：有3种操作（1）add x:向序列添加x，添加后仍然有序；（2）del x:删除序列中值为x的元素；（3）sum:求下标模5为3的元素和。</p>
</blockquote>
<p>  由于线段树不支持添加删除，采用离线做法。先离散化数组，用<span class="math inline">\(sum\)</span>数组记录模5的5种情况和，从而添加或删除一个元素时对<span class="math inline">\(sum[1]\)</span>修改，<span class="math inline">\(cnt\)</span>表示线段树某节点区间数的个数，右子节点下标<span class="math inline">\(i\)</span>在父节点对应下标<span class="math inline">\(i+lson.cnt\)</span>，那么父节点<span class="math inline">\(sum[i]\)</span>等于左子节点<span class="math inline">\(sum[i]\)</span>加上右子节点<span class="math inline">\(sum[(i+lson.cnt)\%5]\)</span>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> debug(x) cout &lt;&lt; #x &lt;&lt; <span class="hljs-meta-string">" is "</span> &lt;&lt; x &lt;&lt; endl</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> inc(i, a, b) for (int i = a; i &lt;= b; ++i)</span></span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e5</span> + <span class="hljs-number">5</span>, INF = <span class="hljs-number">2e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span> &#123;</span></span><br><span class="line">	<span class="hljs-keyword">int</span> l, r, cnt;</span><br><span class="line">	ll sum[<span class="hljs-number">5</span>];</span><br><span class="line">&#125;t[N&lt;&lt;<span class="hljs-number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">char</span> q[N];</span><br><span class="line"><span class="hljs-keyword">int</span> a[N], b[N];</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	t[p].l = l, t[p].r = r;</span><br><span class="line">	t[p].cnt = <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-built_in">memset</span>(t[p].sum, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(t[p].sum));</span><br><span class="line">	<span class="hljs-keyword">if</span> (l == r) &#123; <span class="hljs-keyword">return</span>; &#125;</span><br><span class="line">	<span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">	build(p&lt;&lt;<span class="hljs-number">1</span>, l, mid);</span><br><span class="line">	build(p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_up</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; ++i)</span><br><span class="line">		t[p].sum[i] = t[p&lt;&lt;<span class="hljs-number">1</span>].sum[i] + t[p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>].sum[((i-t[p&lt;&lt;<span class="hljs-number">1</span>].cnt)%<span class="hljs-number">5</span>+<span class="hljs-number">5</span>)%<span class="hljs-number">5</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">	t[p].cnt += y;</span><br><span class="line">	<span class="hljs-keyword">if</span> (t[p].l == t[p].r) &#123;</span><br><span class="line">		t[p].sum[<span class="hljs-number">1</span>] += y * b[x];</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">int</span> mid = (t[p].l + t[p].r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (x &lt;= mid) update(p&lt;&lt;<span class="hljs-number">1</span>, x, y);</span><br><span class="line">	<span class="hljs-keyword">else</span> update(p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, x, y);</span><br><span class="line">	push_up(p);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">int</span> n;</span><br><span class="line">	<span class="hljs-keyword">char</span> op[<span class="hljs-number">5</span>];</span><br><span class="line">	<span class="hljs-keyword">while</span> (~<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;n)) &#123;</span><br><span class="line">		<span class="hljs-keyword">int</span> num = <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">			<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%s"</span>, op);</span><br><span class="line">			q[i] = op[<span class="hljs-number">0</span>];</span><br><span class="line">			<span class="hljs-keyword">if</span> (q[i] != <span class="hljs-string">'s'</span>) &#123;</span><br><span class="line">				<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>, &amp;a[i]);</span><br><span class="line">				b[++num] = a[i];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		sort(b + <span class="hljs-number">1</span>, b + num + <span class="hljs-number">1</span>);</span><br><span class="line">		num = unique(b + <span class="hljs-number">1</span>, b + num + <span class="hljs-number">1</span>) - b - <span class="hljs-number">1</span>;</span><br><span class="line">		build(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, n);</span><br><span class="line">		<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">			<span class="hljs-keyword">int</span> pos = lower_bound(b + <span class="hljs-number">1</span>, b + num + <span class="hljs-number">1</span>, a[i]) - b;</span><br><span class="line">			<span class="hljs-keyword">if</span> (q[i] == <span class="hljs-string">'s'</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, t[<span class="hljs-number">1</span>].sum[<span class="hljs-number">3</span>]);</span><br><span class="line">			<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (q[i] == <span class="hljs-string">'a'</span>) update(<span class="hljs-number">1</span>, pos, <span class="hljs-number">1</span>);</span><br><span class="line">			<span class="hljs-keyword">else</span> update(<span class="hljs-number">1</span>, pos, <span class="hljs-number">-1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><a href="http://poj.org/problem?id=3225" target="_blank" rel="noopener">poj3225 Help with Intervals</a></p>
<blockquote>
<p>题意：给定初始集合为<span class="math inline">\(\varnothing\)</span>，给出一系列（<span class="math inline">\(0\sim65535\)</span>条）并(U)、交(I)、减(D)、被减(C)、异或(S)一个区间（区间<span class="math inline">\([0,65535]\)</span>的子区间）命令，输出执行命令后的集合。</p>
</blockquote>
<p>  建立线段树，区间包括的为1，不包括的为0。将区间扩大为两倍，线段数中偶数存点，奇数存线段，即0号表示<span class="math inline">\([0,0]\)</span>，1号表示<span class="math inline">\((0,1)\)</span>，2号表示<span class="math inline">\([1,1]\)</span>，3号表示<span class="math inline">\((1,2)\cdots\)</span>。那么</p>
<p>  U:区间<span class="math inline">\([l,r]\)</span>置1</p>
<p>  I:区间<span class="math inline">\([-\infty,l)(r,\infty]\)</span>置0</p>
<p>  D:区间<span class="math inline">\([l,r]\)</span>置0</p>
<p>  C:区间<span class="math inline">\([-\infty,l)(r,\infty]\)</span>置0，区间<span class="math inline">\([l,r]\)</span>翻转<span class="math inline">\(0/1\)</span></p>
<p>  S:区间<span class="math inline">\([l,r]\)</span>翻转<span class="math inline">\(0/1\)</span></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> debug(x) cout &lt;&lt; #x &lt;&lt; <span class="hljs-meta-string">" is "</span> &lt;&lt; x &lt;&lt; endl</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> inc(i, a, b) for (int i = a; i &lt;= b; ++i)</span></span><br><span class="line"><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> ll;</span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">65536</span> * <span class="hljs-number">2</span>, INF = <span class="hljs-number">2e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span> &#123;</span></span><br><span class="line">	<span class="hljs-keyword">int</span> l, r;</span><br><span class="line">	<span class="hljs-keyword">int</span> flip, dat;</span><br><span class="line">&#125;t[N&lt;&lt;<span class="hljs-number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">int</span> id[N];</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">build</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	t[p].l = l, t[p].r = r;</span><br><span class="line">	t[p].flip = <span class="hljs-number">0</span>, t[p].dat = <span class="hljs-number">-1</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (l == r) &#123; id[l] = p; <span class="hljs-keyword">return</span>; &#125;</span><br><span class="line">	<span class="hljs-keyword">int</span> mid = (l + r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">	build(p&lt;&lt;<span class="hljs-number">1</span>, l, mid);</span><br><span class="line">	build(p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, mid + <span class="hljs-number">1</span>, r);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">push_down</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (t[p].dat != <span class="hljs-number">-1</span>) &#123;</span><br><span class="line">		t[p&lt;&lt;<span class="hljs-number">1</span>].dat = t[p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>].dat = t[p].dat;</span><br><span class="line">		t[p&lt;&lt;<span class="hljs-number">1</span>].flip = t[p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>].flip = <span class="hljs-number">0</span>;</span><br><span class="line">		t[p].dat = <span class="hljs-number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">if</span> (t[p].flip) &#123;</span><br><span class="line">		t[p&lt;&lt;<span class="hljs-number">1</span>].flip ^= <span class="hljs-number">1</span>;</span><br><span class="line">		t[p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>].flip ^= <span class="hljs-number">1</span>;</span><br><span class="line">		t[p].flip = <span class="hljs-number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p, <span class="hljs-keyword">int</span> l, <span class="hljs-keyword">int</span> r, <span class="hljs-keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (l &gt; r) <span class="hljs-keyword">return</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (l &lt;= t[p].l &amp;&amp; r &gt;= t[p].r) &#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (v != <span class="hljs-number">-1</span>) &#123;</span><br><span class="line">			t[p].dat = v;</span><br><span class="line">			t[p].flip = <span class="hljs-number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> t[p].flip ^= <span class="hljs-number">1</span>;</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	push_down(p);</span><br><span class="line">	<span class="hljs-keyword">int</span> mid = (t[p].l + t[p].r) &gt;&gt; <span class="hljs-number">1</span>;</span><br><span class="line">	<span class="hljs-keyword">if</span> (l &lt;= mid) update(p&lt;&lt;<span class="hljs-number">1</span>, l, r, v);</span><br><span class="line">	<span class="hljs-keyword">if</span> (r &gt; mid) update(p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>, l, r, v);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">query</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p)</span> </span>&#123;</span><br><span class="line">	<span class="hljs-keyword">if</span> (t[p].l == t[p].r) &#123;</span><br><span class="line">		<span class="hljs-keyword">if</span> (t[p].dat == <span class="hljs-number">-1</span>) t[p].dat = <span class="hljs-number">0</span>;</span><br><span class="line">		<span class="hljs-keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	push_down(p);</span><br><span class="line">	query(p&lt;&lt;<span class="hljs-number">1</span>);</span><br><span class="line">	query(p&lt;&lt;<span class="hljs-number">1</span>|<span class="hljs-number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">	<span class="hljs-keyword">char</span> op, a, b;</span><br><span class="line">	<span class="hljs-keyword">int</span> l, r;</span><br><span class="line">	build(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, N);</span><br><span class="line">	<span class="hljs-keyword">while</span> (~<span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%c %c%d,%d%c\n"</span>, &amp;op, &amp;a, &amp;l, &amp;r, &amp;b)) &#123;</span><br><span class="line">		l = (l&lt;&lt;<span class="hljs-number">1</span>) + (a == <span class="hljs-string">'('</span>);</span><br><span class="line">		r = (r&lt;&lt;<span class="hljs-number">1</span>) - (b == <span class="hljs-string">')'</span>);</span><br><span class="line">		<span class="hljs-keyword">if</span> (op == <span class="hljs-string">'U'</span>) update(<span class="hljs-number">1</span>, l, r, <span class="hljs-number">1</span>);</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (op == <span class="hljs-string">'I'</span>) &#123;</span><br><span class="line">			update(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, l - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);</span><br><span class="line">			update(<span class="hljs-number">1</span>, r + <span class="hljs-number">1</span>, N, <span class="hljs-number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (op == <span class="hljs-string">'D'</span>) update(<span class="hljs-number">1</span>, l, r, <span class="hljs-number">0</span>);</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (op == <span class="hljs-string">'C'</span>) &#123;</span><br><span class="line">			update(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, l - <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);</span><br><span class="line">			update(<span class="hljs-number">1</span>, r + <span class="hljs-number">1</span>, N, <span class="hljs-number">0</span>);</span><br><span class="line">			update(<span class="hljs-number">1</span>, l, r, <span class="hljs-number">-1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> update(<span class="hljs-number">1</span>, l, r, <span class="hljs-number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	query(<span class="hljs-number">1</span>);</span><br><span class="line">	<span class="hljs-keyword">int</span> pre, flag = <span class="hljs-number">0</span>, ok = <span class="hljs-number">0</span>;</span><br><span class="line">	<span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; N; ++i) &#123;</span><br><span class="line">		<span class="hljs-keyword">int</span> p = id[i];</span><br><span class="line">		<span class="hljs-keyword">int</span> tmp = t[p].dat ^ t[p].flip;</span><br><span class="line">		<span class="hljs-keyword">if</span> (!tmp &amp;&amp; flag) &#123;</span><br><span class="line">			<span class="hljs-keyword">if</span> (ok) <span class="hljs-built_in">printf</span>(<span class="hljs-string">" "</span>);</span><br><span class="line">			<span class="hljs-keyword">else</span> ok = <span class="hljs-number">1</span>;</span><br><span class="line">			<span class="hljs-keyword">if</span> (pre &amp; <span class="hljs-number">1</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"("</span>);</span><br><span class="line">			<span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"["</span>);</span><br><span class="line">			<span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d,%d"</span>, pre / <span class="hljs-number">2</span>, i / <span class="hljs-number">2</span>);</span><br><span class="line">			<span class="hljs-keyword">if</span> (i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>) <span class="hljs-built_in">printf</span>(<span class="hljs-string">")"</span>);</span><br><span class="line">			<span class="hljs-keyword">else</span> <span class="hljs-built_in">printf</span>(<span class="hljs-string">"]"</span>);</span><br><span class="line">			flag = <span class="hljs-number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tmp &amp;&amp; !flag) &#123;</span><br><span class="line">			pre = i;</span><br><span class="line">			flag = <span class="hljs-number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="hljs-keyword">if</span> (!ok) <span class="hljs-built_in">printf</span>(<span class="hljs-string">"empty set"</span>);</span><br><span class="line">	<span class="hljs-built_in">puts</span>(<span class="hljs-string">""</span>);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css"><!--pspan= __('copyright_title_prefix')
= page.title--><p><span>文章作者：</span>wtyang</p><!--pspan= __('copyright_date_prefix')
= page.date.format(config.date_format)--><!--pspan= __('copyright_update_prefix')
= page.updated.format(config.date_format)--><p><span>原始链接：</span><a href="/Algorithm/Learing-Segment-Tree/">https://2inf.top/Algorithm/Learing-Segment-Tree/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://2inf.top/Algorithm/Learing-Segment-Tree/"></i></span></p><p><span>版权声明：</span>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="noopener">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a> 许可协议。转载请注明出处！</p></div><br><div class="tags"><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%BA%BF%E6%AE%B5%E6%A0%91/"><i class="fa fa-tag"></i>数据结构-线段树</a></div><div class="post-nav"><a class="pre" href="/Python/Python-NumPy/">Python科学计算-NumPy</a><a class="next" href="/Algorithm/Dancing-Links/">跳舞链</a></div></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">2inf</a>&nbsp;|&nbsp;<a href="http://www.beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">湘ICP备20012049号-1 </a>|&nbsp;
<a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i>&nbsp;RSS Feed</a><div><link rel="stylesheet" type="text/css" href="/css/badge.css"/><div class="github-badge"><a rel="nofollow" target="_blank" href="https://hexo.io"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hexo</span></a></div>
<div class="github-badge"> <a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"><span class="badge-subject">Theme</span><span class="badge-value bg-orange">maupassant</span></a></div>
<div class="github-badge"> <a rel="nofollow" target="_blank" href="https://www.cnblogs.com/2inf/"><span class="badge-subject">cnblogs</span><span class="badge-value bg-blueviolet">2inf</span></a></div></div></div></div></div><div class="post-toc"><div class="post-toc-wrap"><div class="post-toc" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#基础"><span class="toc-number">1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#概念"><span class="toc-number">1.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#经典应用"><span class="toc-number">1.2.</span> <span class="toc-text">经典应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#区间最值"><span class="toc-number">1.2.1.</span> <span class="toc-text">区间最值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#区间求和"><span class="toc-number">1.2.2.</span> <span class="toc-text">区间求和</span></a></li></ol></li></ol></li></ol></div></div><div class="post-toc-toggle-wrap open" id="right-toggle"><div class="post-toc-toggle-first post-toc-toggle"></div><div class="post-toc-toggle-second post-toc-toggle"></div><div class="post-toc-toggle-thrid post-toc-toggle"></div></div><script type="text/javascript" src="/js/sidebar.js?v=0.0.0" async></script></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']], processClass: 'math', processEscapes: true },
  TeX: {equationNumbers: { autoNumber: ['AMS'], useLabelIds: true }},
  'HTML-CSS': { linebreaks: { automatic: true } },
  SVG: { linebreaks: { automatic: true } }
  });
</script><!--script(type='text/javascript', src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', async)--><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script><script>hljs.initHighlightingOnLoad();</script><script type="text/javascript" src="/js/app.js?v=0.0.0"></script></div></body></html>