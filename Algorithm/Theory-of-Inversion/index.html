<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>反演原理及应用 | 2inf</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><!-- modified--><link rel="stylesheet" type="text/css" href="/css/atom-one-dark.min.css?v=0.0.0"><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script><!----><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">反演原理及应用</h1><a id="logo" href="/.">2inf</a><p class="description">wtyangのスペース(spread nonsense)</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/" target="_self"><i class="fa fa-archive"> 归档</i></a><a href="/tags/" target="_self"><i class="fa fa-tags"> 标签</i></a><a href="/about/" target="_self"><i class="fa fa-user"> 关于</i></a><a href="https://note.2inf.top" target="_self"><i class="fa fa-book"> 笔记</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">反演原理及应用</h1><div class="post-meta">2019-08-25<span> | </span><span class="category"><a href="/categories/Algorithm/">Algorithm</a></span></div><div class="post-content"><h1>什么是反演</h1>
<p>  对于数列$\left{f_n\right}$以及数列$\left{g_n\right}$满足</p>
<p>$$g_n=\sum_{i=0}^na_{ni}f_i \tag{1}$$</p>
<p>  反演便是利用$\left{g_n\right}$反推出$\left{f_n\right}$, 也即</p>
<p>$$f_n=\sum_{i=0}^nb_{ni}g_i \tag{2}$$</p>
<p>  本质上来说这是一个反解线性方程组的过程, 但观察后会发现整个方程组是一个下三角矩阵, 可以思考出更加快捷的方法</p>
<a id="more"></a> 
<h1>反演原理</h1>
<p>  为了便于后面的叙述, 首先引入$\delta(i,j)$函数$(Kronecker’s\ delta)$, 它的定义为</p>
<p>$$\delta\left(i,j\right)=\begin{cases}1\quad i=j\0\quad i\neq j\end{cases}\qquad(\text{也可记为}[i=j])$$</p>
<p>  下面考虑反演的过程, 考虑下面的式子应该满足什么条件</p>
<p>$$<br>
\sum_{i=0}^nb_{ni}g_i=f_n \tag{3}<br>
$$</p>
<p>$$<br>
\begin{array}{l}<br>
LHS&amp;=&amp;\displaystyle\sum_{i=0}^nb_{ni}g_i\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>nb_{ni}\sum_{j=0}</sup>ia_{ij}f_j\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>nf_i\sum_{j=i}</sup>nb_{nj}a_{ji}<br>
\end{array}<br>
$$</p>
<p>  为了便于理解最后一步, 我们用矩阵进行表示</p>
<p>$$<br>
\begin{bmatrix}<br>
b_{n0}a_{00}f_0\<br>
b_{n1}a_{10}f_0 &amp; b_{n1}a_{11}f_1\<br>
b_{n2}a_{20}f_0 &amp; b_{n2}a_{21}f_1 &amp; b_{n2}a_{22}f_2\<br>
\vdots &amp; \vdots &amp; \ddots \<br>
b_{nn}a_{n0}f_0 &amp; b_{nn}a_{n1}f_1 &amp; \cdots &amp; b_{nn}a_{nn}f_n<br>
\end{bmatrix}<br>
$$</p>
<p>  前一个是<strong>对行</strong>进行, 再将行加起来, 后一个是<strong>对列</strong>进行, 再将列加起来</p>
<p>  因此, 式$(3)$成立的条件等价于</p>
<p>$$\sum_{j=i}^nb_{nj}a_{ji}=\delta(n,i) \tag{4}$$</p>
<p>  同理, 将$f$代入带$g$的求和式中, 可以推出</p>
<p>$$\sum_{j=i}^na_{nj}b_{ji}=\delta(n,i) \tag{5}$$</p>
<p>  如果某个数列满足上面的条件, 我们便阔以利用反演公式</p>
<h1>二项式反演</h1>
<h2 id="原理"><a class="header-anchor" href="#原理">¶</a>原理</h2>
<p>  二项式反演$(binomial\ inversion)$在容斥中经常用到, 可以表示为</p>
<p>$$<br>
f_n=\sum_{i=0}<sup>n\left(-1\right)</sup>n\begin{pmatrix}n\i\end{pmatrix}g_i\Leftrightarrow<br>
g_n=\sum_{i=0}<sup>n\left(-1\right)</sup>n\begin{pmatrix}n\i\end{pmatrix}<br>
f_i \tag{6}<br>
$$</p>
<p>  可以写成另一种常见形式</p>
<p>$$<br>
f_n=\sum_{i=0}^n\begin{pmatrix}n\i\end{pmatrix}g_i\Leftrightarrow<br>
g_n=\sum_{i=0}<sup>n\left(-1\right)</sup>{n-i}\begin{pmatrix}n\i\end{pmatrix}f_i \tag{7}<br>
$$</p>
<p><strong>证明:</strong></p>
<p>$$\begin{array}{l}<br>
g_n&amp;=&amp;\displaystyle\sum_{i=0}<sup>n\left(-1\right)</sup>{n-i}\begin{pmatrix}n\i\end{pmatrix}f_i\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>n\left(-1\right)</sup>{n-i}\begin{pmatrix}n\i\end{pmatrix}\sum_{j=0}^i\begin{pmatrix}i\j\end{pmatrix}g_j\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>ng_i\sum_{j=i}</sup>n\begin{pmatrix}n\j\end{pmatrix}\begin{pmatrix}j\i\end{pmatrix}\left(-1\right)^{n-j}\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>ng_i\sum_{j=i}</sup>n\begin{pmatrix}n\i\end{pmatrix}\begin{pmatrix}n-i\j-i\end{pmatrix}\left(-1\right)^{n-j}\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>ng_i\begin{pmatrix}n\i\end{pmatrix}\sum_{j=0}</sup>{n-i}\begin{pmatrix}n-i\j\end{pmatrix}\left(-1\right)^{n-i-j}\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>ng_i\begin{pmatrix}n\i\end{pmatrix}\left(1-1\right)</sup>{n-i}\<br>
&amp;=&amp;g_n<br>
\end{array}$$</p>
<h2 id="应用"><a class="header-anchor" href="#应用">¶</a>应用</h2>
<ul>
<li>错位排列</li>
</ul>
<p>  对于长度为$n$的序列${a_i}$, 求所有满足$1\leq i\leq n$, 使得$a_i\neq i$的种类数</p>
<p>  一个高中生想到的常规方法可能是利用递推, 记所求为$D_n$, $n$个错位排列按照第一位是$2,3,\cdots,n$分成$n-1$, 每个组排列个数一样多, 考虑其中一组, 不妨设第一位为$2$, 若第$2$位是$1$,有$D_{n-2}$种, 否则有$D_{n-1}$种, 结合$D_1=0,\ D_2=1$, 从而有</p>
<p>$$D_n=(n-1)(D_{n-1}+D_{n-2}) \tag{8}$$<br>
$$D_n-nD_{n-1}=-\left(D_{n-1}-(n-1)D_{n-2}\right)=\cdots=(-1)^{n-2} \tag{9}$$<br>
$$D_n=nD_{n-1}+(-1)<sup>n=\cdots=n!\sum_{i=0}</sup>n\frac{(-1)^i}{i!} \tag{10}$$</p>
<p>  回到正题, 我们有一个有意思的解法, 设$f_i$为恰好有$i$个位置是不变的排列, 那么<br>
$$n!=\sum_{i=0}^n\begin{pmatrix}n\i\end{pmatrix}f_i \tag{11}$$<br>
  可以看粗其形式和反演公式很像, 令$g_i=i!$, 有二项式反演<br>
$$\begin{array}{l}<br>
f_n&amp;=&amp;\displaystyle\sum_{i=0}<sup>n(-1)</sup>{n-i}\begin{pmatrix}n\i\end{pmatrix}g_i\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>n(-1)</sup>{n-i}\frac{n!}{(n-i)!}\<br>
&amp;=&amp;n!\displaystyle\sum_{i=0}<sup>n\frac{(-1)</sup>i}{i!}<br>
\end{array}<br>
$$</p>
<ul>
<li>染色问题</li>
</ul>
<p>  $n$个球排成一行, 有$m$种颜色, 每个球染一个颜色, 相邻两个球染不同颜色, 每种颜色至少使用一次, 求染色方案数</p>
<p>  不考虑每种颜色至少用一次这一条件, 那么答案显然是$m(m-1)^{n-1}$, 设$f_i$为恰好使用$i(i=0,1,2,\cdots,k)$种颜色的方案数, 那么</p>
<p>$$m(m-1)<sup>{n-1}=\sum_{i=0}</sup>m\begin{pmatrix}m\i\end{pmatrix}f_i \tag{12}$$</p>
<p>  经过反演得到</p>
<p>$$f_m=\sum_{i=0}<sup>m(-1)</sup>{m-i}\begin{pmatrix}m\i\end{pmatrix}g_i \tag{13}$$</p>
<p><a href="https://bzoj.zcmimi.tk/p/2839.html" target="_blank" rel="noopener">$BZOJ2839$:集合计数</a></p>
<p>  记$b_i$为交集有至少$i$个集合的个数, 枚举$i$个交集后, 共有$2^{n-i}$个互不相同的集合, 每个集合又有选与不选两种方案, 故$b_i=\begin{pmatrix}n\i\end{pmatrix}2<sup>{2</sup>{n-i}}$, 那么我们开始演了</p>
<p>$$b_k=\sum_{i=k}^n\begin{pmatrix}i\k\end{pmatrix}a_i\quad\Leftrightarrow\quad a_k=\sum_{i=k}<sup>n(-1)</sup>{n-k}\begin{pmatrix}i\k\end{pmatrix}b_i$$</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> pii pair<span class="hljs-meta-string">&lt;int,int&gt;</span></span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> inc(i,l,r) for(int i=l;i&lt;=r;++i)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> dec(i,l,r) for(int i=r;i&gt;=l;--i)</span></span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> mem(a,v) memset(a,v,sizeof(a))</span></span><br><span class="line"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N = <span class="hljs-number">1e6</span>, INF = <span class="hljs-number">0x3f3f3f3f</span>;</span><br><span class="line"><span class="hljs-keyword">const</span> ll MOD = <span class="hljs-number">1e9</span> + <span class="hljs-number">7</span>;</span><br><span class="line"><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt;</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">read</span><span class="hljs-params">(T &amp;x)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    x = <span class="hljs-number">0</span>; ll f = <span class="hljs-number">1</span>; <span class="hljs-keyword">char</span> ch = getchar();</span><br><span class="line">    <span class="hljs-keyword">while</span> (!<span class="hljs-built_in">isdigit</span>(ch)) &#123;<span class="hljs-keyword">if</span>(ch == <span class="hljs-string">'-'</span>) f = <span class="hljs-number">-1</span>; ch = getchar();&#125;</span><br><span class="line">    <span class="hljs-keyword">while</span> (<span class="hljs-built_in">isdigit</span>(ch)) x = (x&lt;&lt;<span class="hljs-number">3</span>) + (x&lt;&lt;<span class="hljs-number">1</span>) + ch - <span class="hljs-string">'0'</span>, ch = getchar();</span><br><span class="line">    x *= f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ll n, k, ans;</span><br><span class="line">ll fac[N], inv[N], p[N];</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">ll <span class="hljs-title">power</span><span class="hljs-params">(ll a, ll b)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    ll res = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (; b; a = a * a % MOD, b &gt;&gt;= <span class="hljs-number">1</span>)</span><br><span class="line">        <span class="hljs-keyword">if</span> (b &amp; <span class="hljs-number">1</span>) res = res * a % MOD;</span><br><span class="line">    <span class="hljs-keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function">ll <span class="hljs-title">C</span><span class="hljs-params">(ll n, ll m)</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">return</span> fac[n] * inv[m] % MOD * inv[n-m] % MOD;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    read(n), read(k);</span><br><span class="line">    fac[<span class="hljs-number">0</span>] = inv[<span class="hljs-number">0</span>] = p[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;</span><br><span class="line">    inc(i,<span class="hljs-number">1</span>,n) fac[i] = (ll)fac[i<span class="hljs-number">-1</span>] * i % MOD, p[i] = (ll)p[i<span class="hljs-number">-1</span>] * <span class="hljs-number">2</span> % (MOD - <span class="hljs-number">1</span>);</span><br><span class="line">    inv[n] = power(fac[n], MOD - <span class="hljs-number">2</span>);</span><br><span class="line">    dec(i,<span class="hljs-number">1</span>,n<span class="hljs-number">-1</span>) inv[i] = (ll)inv[i+<span class="hljs-number">1</span>] * (i + <span class="hljs-number">1</span>) % MOD;</span><br><span class="line">    inc(i,k,n) &#123;</span><br><span class="line">        (ans += MOD + ((i-k) &amp; <span class="hljs-number">1</span> ? <span class="hljs-number">-1</span> : <span class="hljs-number">1</span>) * (C(i,k) * C(n,i) % MOD * (power(<span class="hljs-number">2</span>, p[n-i]) % MOD))) %= MOD;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%lld\n"</span>, ans);</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>斯特林反演</h1>
<h2 id="原理-v2"><a class="header-anchor" href="#原理-v2">¶</a>原理</h2>
<p>  在这里, 先回顾一下斯特林数($dalao$请自动忽略)</p>
<ul>
<li><strong>第一类斯特林数</strong></li>
</ul>
<p>  <strong>定义:</strong> 将$n$个元素排成$m$个轮换的方法数</p>
<p>  从$n-1$的情况推过来, 要么将最后一个元素放进自身的轮换, 要么将最后一个元素放进前$n-1$个元素分成的$\begin{bmatrix}n-1\m\end{bmatrix}$个轮换中的一个, 可以得到:</p>
<p>$$\begin{bmatrix}n\m\end{bmatrix}=\begin{bmatrix}n-1\m-1\end{bmatrix}+(n-1)*\begin{bmatrix}n-1\m\end{bmatrix} \tag{14}$$</p>
<p>  由于$\begin{bmatrix}n\<br>
k\end{bmatrix}$是$n$个元素恰好包含$k$个轮换的排列个数, 对所有的$k$求和, 必然得到排列的总数</p>
<p>$$\sum_{k=0}^n\begin{bmatrix}n\<br>
k\end{bmatrix}=n! \tag{15}$$</p>
<p>  下面是与下降幂$x<sup>{\underline{n}}$和阶乘幂$x</sup>{\overline{n}}$的关系</p>
<p>$$x<sup>{\underline{n}}=\sum_{i=0}</sup>n\begin{bmatrix}n\i\end{bmatrix}(-1)<sup>{n-i}x</sup>i \tag{16}$$</p>
<p>  用归纳法证明</p>
<p>$$\begin{array}{l}<br>
x<sup>{\underline{n+1}}&amp;=&amp;(x-n)x</sup>{\underline{n}}\<br>
&amp;=&amp;(x-n)\displaystyle\sum_{i=0}<sup>n\begin{bmatrix}n\i\end{bmatrix}(-1)</sup>{n-i}x^i\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>n\begin{bmatrix}n\i\end{bmatrix}(-1)</sup>{n-i}x<sup>{i+1}-n\sum_{i=0}</sup>{n+1}\begin{bmatrix}n\i\end{bmatrix}(-1)<sup>{n-i}x</sup>i\<br>
&amp;=&amp;\displaystyle\sum_{i=1}<sup>{n+1}\begin{bmatrix}n\i-1\end{bmatrix}(-1)</sup>{n-i+1}x<sup>{i}+n\sum_{i=0}</sup>{n+1}\begin{bmatrix}n\i\end{bmatrix}(-1)<sup>{n-i+1}x</sup>i\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>{n+1}\left(\begin{bmatrix}n\i-1\end{bmatrix}+n\begin{bmatrix}n\i\end{bmatrix}\right)(-1)</sup>{n-i+1}x^i\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>{n+1}\begin{bmatrix}n+1\i\end{bmatrix}(-1)</sup>{n+1-i}x^i<br>
\end{array}$$</p>
<p>  类似可以证明</p>
<p>$$x<sup>{\overline{n}}=\sum_{i=0}</sup>n\begin{bmatrix}n\i\end{bmatrix}x^i \tag{17}$$</p>
<ul>
<li><strong>第二类斯特林数</strong></li>
</ul>
<p>  <strong>定义:</strong> 将一个有$n$件物品的集合划分成$m$个非空子集的方法数</p>
<p>  从$n-1$的情况推过来, 要么将最后一个元素单独放一类, 要么与前$n-1$个元素的某个非空子集放一起, 可以得到:</p>
<p>$$\begin{Bmatrix}n\m\end{Bmatrix}=\begin{Bmatrix}n-1\m-1\end{Bmatrix}+m*\begin{Bmatrix}n-1\m\end{Bmatrix} \tag{18}$$</p>
<p>  下面是与下降幂$x<sup>{\underline{n}}$和阶乘幂$x</sup>{\overline{n}}$的关系</p>
<p>$$m<sup>n=\sum_{i=0}</sup>n\begin{Bmatrix}n\i\end{Bmatrix}m^{\underline{i}} \tag{19}$$</p>
<p>  用归纳法证明, 由于$x*x<sup>{\underline{i}}=x</sup>{\underline{i+1}}+ix^{\underline{i}}$</p>
<p>$$\begin{array}{l}<br>
m<sup>{n+1}&amp;=&amp;m\displaystyle\sum_{i=0}</sup>n\begin{Bmatrix}n\i\end{Bmatrix}m^{\underline{i}}\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>n\begin{Bmatrix}n\i\end{Bmatrix}m</sup>{\underline{i+1}}+\sum_{i=0}<sup>n\begin{Bmatrix}n\i\end{Bmatrix}im</sup>{\underline{i}}\<br>
&amp;=&amp;\displaystyle\sum_{i=1}<sup>{n+1}\begin{Bmatrix}n\i-1\end{Bmatrix}m</sup>{\underline{i}}+\sum_{i=0}<sup>{n+1}\begin{Bmatrix}n\i\end{Bmatrix}im</sup>{\underline{i}}\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>{n+1}\left(\begin{Bmatrix}n\i-1\end{Bmatrix}+i\begin{Bmatrix}n\i\end{Bmatrix}\right)m</sup>{\underline{i}}\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>{n+1}\begin{Bmatrix}n+1\i\end{Bmatrix}m</sup>{\underline{i}}<br>
\end{array}$$</p>
<p>  类似可以证明</p>
<p>$$m<sup>n=\sum_{i=0}</sup>n\begin{Bmatrix}n\i\end{Bmatrix}(-1)<sup>{n-i}m</sup>{\overline{i}} \tag{20}$$</p>
<p>  当然还有两个比较显然的东西</p>
<p>$$x<sup>{\underline{n}}=(-1)(-x)</sup>{\overline{n}} \tag{21}$$<br>
$$x<sup>{\overline{n}}=(-1)(-x)</sup>{\underline{n}} \tag{22}$$</p>
<ul>
<li><strong>反转公式</strong></li>
</ul>
<p>$$\sum_{k=m}<sup>n(-1)</sup>{n-k}\begin{bmatrix}n\k\end{bmatrix}\begin{Bmatrix}k\m\end{Bmatrix}=[m=n] \tag{23}$$</p>
<p>$$\sum_{k=m}<sup>n(-1)</sup>{n-k}\begin{Bmatrix}n\k\end{Bmatrix}\begin{bmatrix}k\m\end{bmatrix}=[m=n] \tag{24}$$</p>
<p>$proof\ 1:$</p>
<p>$$\begin{array}{l}<br>
m<sup>{\underline{n}}&amp;=&amp;\displaystyle\sum_{i=0}</sup>n\begin{bmatrix}n\i\end{bmatrix}(-1)<sup>{n-i}m</sup>i\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>n\begin{bmatrix}n\i\end{bmatrix}(-1)</sup>{n-i}\sum_{j=0}<sup>i\begin{Bmatrix}i\j\end{Bmatrix}m</sup>{\underline{j}}\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>nm</sup>{\underline{i}}\sum_{j=i}<sup>n(-1)</sup>{n-j}\begin{bmatrix}n\j\end{bmatrix}\begin{Bmatrix}j\i\end{Bmatrix}<br>
\end{array}$$</p>
<p>$proof\ 2:$</p>
<p>$$\begin{array}{l}<br>
m<sup>n&amp;=&amp;\displaystyle\sum_{i=0}</sup>n\begin{Bmatrix}n\i\end{Bmatrix}m^{\underline{i}}\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>n\begin{Bmatrix}n\i\end{Bmatrix}\sum_{j=0}</sup>i(-1)<sup>{i-j}\begin{bmatrix}i\j\end{bmatrix}m</sup>j\<br>
&amp;=&amp;\displaystyle\sum_{i=0}<sup>nm</sup>i\sum_{j=i}<sup>n(-1)</sup>{n-j}\begin{Bmatrix}n\j\end{Bmatrix}\begin{bmatrix}j\i\end{bmatrix}<br>
\end{array}$$</p>
<ul>
<li><strong>斯特林反演</strong></li>
</ul>
<p>$$f(n)=\sum_{i=0}^n\begin{Bmatrix}n\k\end{Bmatrix}g(k) \quad\Leftrightarrow\quad g(n)=\sum_{k=0}<sup>n(-1)</sup>{n-k}\begin{bmatrix}n\k\end{bmatrix}f(k) \tag{25}$$</p>
<p>  $(25)$的证明如下:</p>
<p>$$\begin{array}{l}<br>
f(n)&amp;=&amp;\displaystyle\sum_{k=0}^n\begin{Bmatrix}n\k\end{Bmatrix}g(k)\<br>
&amp;=&amp;\displaystyle\sum_{k=0}<sup>n\begin{Bmatrix}n\k\end{Bmatrix}\sum_{j=0}</sup>k(-1)^{k-j}\begin{bmatrix}k\j\end{bmatrix}f(j)\<br>
&amp;=&amp;\displaystyle\sum_{k=0}<sup>n\sum_{j=k}</sup>n\begin{Bmatrix}n\j\end{Bmatrix}\begin{bmatrix}j\k\end{bmatrix}(-1)^{j-k}f(k)\<br>
&amp;=&amp;\displaystyle\sum_{k=0}^n[k=n]f(k)\<br>
&amp;=&amp;f(n)<br>
\end{array}$$</p>
<h1>莫比乌斯反演</h1>
<h2 id="积性函数"><a class="header-anchor" href="#积性函数">¶</a>积性函数</h2>
<p>  函数 $f(n)$ 满足 $f(1)=1,\forall x,y\in \mathbb{N}^*,\gcd(x,y)=1$ 有 $f(xy)=f(x)f(y)$，$f(n)$ 为积性函数。</p>
<p>  仅去掉条件 $\gcd(x,y)=1$ 仍有 $f(xy)=f(x)f(y)$，则 $f(n)$ 为完全积性函数。</p>
<h3 id="性质"><a class="header-anchor" href="#性质">¶</a>性质</h3>
<p>若 $f(x)$ 和 $g(x)$ 均为积性函数，下列函数也为积性函数:</p>
<p>$$f(x<sup>p), f</sup>p(x),\ f(x)g(x),\ \sum_{d|x}f(d)g(\frac{x}{d})$$</p>
<p>设 $x=\prod p_i^{k_i}$</p>
<p>若 $F(x)$ 为积性函数，则有 $F(x)=\prod F(p_i^{k_i})$</p>
<p>若 $F(x)$ 为完全积性函数，则有 $F(x)=\prod F(p_i)^{k_i}$</p>
<h3 id="一些例子"><a class="header-anchor" href="#一些例子">¶</a>一些例子</h3>
<ul>
<li>单位函数 $\varepsilon(n)=[n=1]$ (完全积性)</li>
<li>恒等函数 $\operatorname{id}_k(n)=n^k\operatorname{id}_1(n)$ 通常简记为 $\operatorname{id}(n)$ (完全积性)</li>
<li>常数函数 $1(n)=1$ (完全积性)</li>
<li>除数函数 $\displaystyle\sigma_k(n)=\sum_{d|n}d^k\sigma_0(n)$ 通常简记为 $\operatorname{d}(n)$ 或 $\tau(n)$，$\sigma_1(n)$ 通常简记作 $\sigma(n)$</li>
<li>欧拉函数 $\displaystyle\varphi(n)=\sum_{i=1}^n[\gcd(i,n)=1]$</li>
<li>莫比乌斯函数 $\displaystyle\mu(n)=\begin{cases}1\quad n=1,\(-1)^k\quad n=p_1p_2\cdots p_k,\0\quad otherwise\end{cases}$，$p_i$ 为互异素数</li>
</ul>
<h2 id="dirichlet-卷积"><a class="header-anchor" href="#dirichlet-卷积">¶</a>Dirichlet 卷积</h2>
<p><strong>定义</strong> 两个数论函数的 Dirichlet 卷积</p>
<p>$$(f*g)(n)=\sum_{d|n}f(d)g(\frac{n}{d})$$</p>
<h3 id="性质-v2"><a class="header-anchor" href="#性质-v2">¶</a>性质</h3>
<ul>
<li>交换律 $f<em>g=g</em>f$</li>
<li>结合律 $(f<em>g)<em>h=f</em>(g</em>h)$</li>
<li>分配律 $f*(g+h)=f<em>g+f</em>h$</li>
<li>$f*\varepsilon=f$，其中 $\varepsilon$ 为 Dirichlet 卷积的单位元</li>
</ul>
<h3 id="一些例子-v2"><a class="header-anchor" href="#一些例子-v2">¶</a>一些例子</h3>
<p>$$\varepsilon=\mu<em>1\Leftrightarrow\varepsilon(n)=\sum_{d|n}\mu(d)$$<br>
$$d=1</em>1\Leftrightarrow d(n)=\sum_{d|n}1$$<br>
$$\sigma=\operatorname{id}<em>1\Leftrightarrow\sigma(n)=\sum_{d|n}d$$<br>
$$\varphi=\mu</em>\operatorname{id}\Leftrightarrow\sum_{d|n}d\cdot\mu(\frac{n}{d})$$</p>
<h2 id="原理-v3"><a class="header-anchor" href="#原理-v3">¶</a>原理</h2>
<p>  <strong>莫比乌斯函数$\mu(m)$</strong> 对所有整数$m\geq1由等式$</p>
<p>$$\sum_{d|m}\mu(d)=\left[m=1\right] \tag{26}$$</p>
<p>来定义, 这个等式是一个递归式, 代入$m=1,2,\cdots,12$可以得到前$12$个值:</p>
<table>
<thead>
<tr>
<th style="text-align:center">$m$</th>
<th style="text-align:center">$1$</th>
<th style="text-align:center">$2$</th>
<th style="text-align:center">$3$</th>
<th style="text-align:center">$4$</th>
<th style="text-align:center">$5$</th>
<th style="text-align:center">$6$</th>
<th style="text-align:center">$7$</th>
<th style="text-align:center">$8$</th>
<th style="text-align:center">$9$</th>
<th style="text-align:center">$10$</th>
<th style="text-align:center">$11$</th>
<th style="text-align:center">$12$</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">$\mu(m)$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$-1$</td>
<td style="text-align:center">$-1$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$-1$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$-1$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$0$</td>
<td style="text-align:center">$1$</td>
<td style="text-align:center">$-1$</td>
<td style="text-align:center">$0$</td>
</tr>
</tbody>
</table>
<p>$$g(m)=\sum_{d|m}f(d)\quad\Leftrightarrow\quad f(m)=\sum_{d|m}\mu(\frac{m}{d})g(d) \tag{27}$$</p>
<p>  $(27)$的证明如下:<br>
$$\begin{array}{l}<br>
g(m)&amp;=&amp;\displaystyle\sum_{d|m}f(d)\<br>
&amp;=&amp;\displaystyle\sum_{d|m}\sum_{k|d}\mu(\frac{d}{k})g(k)\<br>
&amp;=&amp;\displaystyle\sum_{k|m}g(k)\sum_{d|m,k|d}\mu(\frac{d}{k})\<br>
&amp;=&amp;\displaystyle\sum_{k|m}g(k)\sum_{d|(m/k)}\mu(d)\<br>
&amp;=&amp;\displaystyle\sum_{k|m}[m/k=1]g(k)\<br>
&amp;=&amp;g(m)<br>
\end{array}$$</p>
<p>  若 d 包含平方因子，则 $\mu(d)=0$</p>
<p>  若 d 不包含平方因子，即$p=p_1p_2\cdots p_k$，$p_i$ 均为互异素数，则 $\mu(d)=(-1)^k$</p>
<p>  $\forall n\in\mathbb{N}^*$，有 $\displaystyle\sum_{d|n}\frac{\mu(d)}{d}=\frac{\varphi(n)}{n}$</p>
<p>线性筛求莫比乌斯函数。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> </span>&#123;</span><br><span class="line">    <span class="hljs-built_in">memset</span>(vis, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(vis));</span><br><span class="line">    mu[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;</span><br><span class="line">    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>; i &lt; N; ++i) &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!vis[i]) &#123; </span><br><span class="line">            prime[++tot] = i;</span><br><span class="line">            mu[i] = <span class="hljs-number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">1</span>; j &lt;= tot &amp;&amp; i * prime[j] &lt; N; ++j) &#123;</span><br><span class="line">            vis[i * prime[j]] = <span class="hljs-number">1</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (i % prime[j] == <span class="hljs-number">0</span>) &#123;</span><br><span class="line">                mu[i * prime[j]] = <span class="hljs-number">0</span>;</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            mu[i * prime[j]] = -mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css"><!--pspan= __('copyright_title_prefix')
= page.title--><p><span>文章作者：</span>wtyang</p><!--pspan= __('copyright_date_prefix')
= page.date.format(config.date_format)--><!--pspan= __('copyright_update_prefix')
= page.updated.format(config.date_format)--><p><span>原始链接：</span><a href="/Algorithm/Theory-of-Inversion/">https://2inf.top/Algorithm/Theory-of-Inversion/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="https://2inf.top/Algorithm/Theory-of-Inversion/"></i></span></p><p><span>版权声明：</span>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" rel="noopener">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a> 许可协议。转载请注明出处！</p></div><br><div class="tags"><a href="/tags/%E7%BB%84%E5%90%88%E6%95%B0%E5%AD%A6/"><i class="fa fa-tag"></i>组合数学</a></div><div class="post-nav"><a class="pre" href="/Math/Talk-about-a-few-special-functions/">浅谈几个特殊函数</a><a class="next" href="/Algorithm/Algorithm-template/">算法模板</a></div></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer">Copyright © 2022 <a href="/." rel="nofollow">2inf</a>&nbsp;|&nbsp;<a href="http://www.beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">湘ICP备20012049号-1 </a>|&nbsp;
<a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i>&nbsp;RSS Feed</a><div><link rel="stylesheet" type="text/css" href="/css/badge.css"/><div class="github-badge"><a rel="nofollow" target="_blank" href="https://hexo.io"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hexo</span></a></div>
<div class="github-badge"> <a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"><span class="badge-subject">Theme</span><span class="badge-value bg-orange">maupassant</span></a></div>
<div class="github-badge"> <a rel="nofollow" target="_blank" href="https://www.cnblogs.com/2inf/"><span class="badge-subject">cnblogs</span><span class="badge-value bg-blueviolet">2inf</span></a></div></div></div></div></div><div class="post-toc"><div class="post-toc-wrap"><div class="post-toc" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">1.</span> <span class="toc-text">什么是反演</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">2.</span> <span class="toc-text">反演原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">3.</span> <span class="toc-text">二项式反演</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#原理"><span class="toc-number">3.1.</span> <span class="toc-text">¶原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用"><span class="toc-number">3.2.</span> <span class="toc-text">¶应用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">4.</span> <span class="toc-text">斯特林反演</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#原理-v2"><span class="toc-number">4.1.</span> <span class="toc-text">¶原理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#undefined"><span class="toc-number">5.</span> <span class="toc-text">莫比乌斯反演</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#积性函数"><span class="toc-number">5.1.</span> <span class="toc-text">¶积性函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#性质"><span class="toc-number">5.1.1.</span> <span class="toc-text">¶性质</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一些例子"><span class="toc-number">5.1.2.</span> <span class="toc-text">¶一些例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dirichlet-卷积"><span class="toc-number">5.2.</span> <span class="toc-text">¶Dirichlet 卷积</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#性质-v2"><span class="toc-number">5.2.1.</span> <span class="toc-text">¶性质</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一些例子-v2"><span class="toc-number">5.2.2.</span> <span class="toc-text">¶一些例子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#原理-v3"><span class="toc-number">5.3.</span> <span class="toc-text">¶原理</span></a></li></ol></li></ol></div></div><div class="post-toc-toggle-wrap open" id="right-toggle"><div class="post-toc-toggle-first post-toc-toggle"></div><div class="post-toc-toggle-second post-toc-toggle"></div><div class="post-toc-toggle-thrid post-toc-toggle"></div></div><script type="text/javascript" src="/js/sidebar.js?v=0.0.0" async></script></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']], processClass: 'math', processEscapes: true },
  TeX: {equationNumbers: { autoNumber: ['AMS'], useLabelIds: true }},
  'HTML-CSS': { linebreaks: { automatic: true } },
  SVG: { linebreaks: { automatic: true } }
  });
</script><!--script(type='text/javascript', src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', async)--><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/mathjax@2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script><script>hljs.initHighlightingOnLoad();</script><script type="text/javascript" src="/js/app.js?v=0.0.0"></script></div></body></html>